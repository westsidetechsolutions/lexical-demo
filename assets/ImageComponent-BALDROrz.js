import{r as e,j as t,e as s,f as r,g as n,u as i,b as a,c as o,h as l,i as c,k as d,m as u,K as h,l as m,n as g,o as p,p as v,D as x,q as f,S as w,s as y,t as b,R as z,T as j,L as C,P as R,v as E,w as N,H,x as P,A as W,N as S,y as D,z as L,B as M,F as k,G as V,I as $,J as I,M as T,O as X,Q as B,U as G,V as _,$ as A}from"./index-BAeg54_S.js";import{L as Y}from"./LexicalNestedComposer-ay-OKJoQ.js";const K="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22%203H2v18h20v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h2V3zm-2%204v2h-2v2h2v2h-2v2h2v2h-2v2H4V5h14v2h2zm-6%202h-2v2h-2v2H8v2H6v2h2v-2h2v-2h2v-2h2v2h2v-2h-2V9zM6%207h2v2H6V7z'%20fill='%23000000'/%3e%3c/svg%3e";function F(e,t,s){return Math.min(Math.max(e,t),s)}const U={east:1,north:8,south:2,west:4};function O({onResizeStart:r,onResizeEnd:n,buttonRef:i,imageRef:a,maxWidth:o,editor:l,showCaption:c,setShowCaption:d,captionsEnabled:u}){const h=e.useRef(null),m=e.useRef({priority:"",value:"default"}),g=e.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),p=l.getRootElement(),v=o||(null!==p?p.getBoundingClientRect().width-20:100),x=null!==p?p.getBoundingClientRect().height-20:100,f=(e,t)=>{if(!l.isEditable())return;const n=a.current,i=h.current;if(null!==n&&null!==i){e.preventDefault();const{width:a,height:o}=n.getBoundingClientRect(),l=s(n),c=g.current;c.startWidth=a,c.startHeight=o,c.ratio=a/o,c.currentWidth=a,c.currentHeight=o,c.startX=e.clientX/l,c.startY=e.clientY/l,c.isResizing=!0,c.direction=t,(e=>{const t=e===U.east||e===U.west,s=e===U.north||e===U.south,r=e&U.north&&e&U.west||e&U.south&&e&U.east,n=t?"ew":s?"ns":r?"nwse":"nesw";null!==p&&p.style.setProperty("cursor",`${n}-resize`,"important"),null!==document.body&&(document.body.style.setProperty("cursor",`${n}-resize`,"important"),m.current.value=document.body.style.getPropertyValue("-webkit-user-select"),m.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))})(t),r(),i.classList.add("image-control-wrapper--resizing"),n.style.height=`${o}px`,n.style.width=`${a}px`,document.addEventListener("pointermove",w),document.addEventListener("pointerup",y)}},w=e=>{const t=a.current,r=g.current,n=r.direction&(U.east|U.west),i=r.direction&(U.south|U.north);if(null!==t&&r.isResizing){const a=s(t);if(n&&i){let s=Math.floor(r.startX-e.clientX/a);s=r.direction&U.east?-s:s;const n=F(r.startWidth+s,100,v),i=n/r.ratio;t.style.width=`${n}px`,t.style.height=`${i}px`,r.currentHeight=i,r.currentWidth=n}else if(i){let s=Math.floor(r.startY-e.clientY/a);s=r.direction&U.south?-s:s;const n=F(r.startHeight+s,100,x);t.style.height=`${n}px`,r.currentHeight=n}else{let s=Math.floor(r.startX-e.clientX/a);s=r.direction&U.east?-s:s;const n=F(r.startWidth+s,100,v);t.style.width=`${n}px`,r.currentWidth=n}}},y=()=>{const e=a.current,t=g.current,s=h.current;if(null!==e&&null!==s&&t.isResizing){const e=t.currentWidth,r=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,s.classList.remove("image-control-wrapper--resizing"),null!==p&&p.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",m.current.value,m.current.priority)),n(e,r),document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",y)}};return t.jsxs("div",{ref:h,children:[!c&&u&&t.jsx("button",{className:"image-caption-button",ref:i,onClick:()=>{d(!c)},children:"Add Caption"}),t.jsx("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{f(e,U.north)}}),t.jsx("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{f(e,U.north|U.east)}}),t.jsx("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{f(e,U.east)}}),t.jsx("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{f(e,U.south|U.east)}}),t.jsx("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{f(e,U.south)}}),t.jsx("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{f(e,U.south|U.west)}}),t.jsx("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{f(e,U.west)}}),t.jsx("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{f(e,U.north|U.west)}})]})}const q=new Set,J=_("RIGHT_CLICK_IMAGE_COMMAND");function Q({altText:e,className:s,imageRef:r,src:n,width:i,height:a,maxWidth:o,onError:l}){return function(e){if(!q.has(e))throw new Promise((t=>{const s=new Image;s.src=e,s.onload=()=>{q.add(e),t(null)},s.onerror=()=>{q.add(e)}}))}(n),t.jsx("img",{className:s||void 0,src:n,alt:e,ref:r,style:{height:a,maxWidth:o,width:i},onError:l,draggable:"false"})}function Z(){return t.jsx("img",{src:K,style:{height:200,opacity:.2,width:200},draggable:"false"})}function ee({src:s,altText:_,nodeKey:K,width:F,height:U,maxWidth:q,resizable:ee,showCaption:te,caption:se,captionsEnabled:re}){const ne=e.useRef(null),ie=e.useRef(null),[ae,oe,le]=r(K),[ce,de]=e.useState(!1),{isCollabActive:ue}=n(),[he]=i(),[me,ge]=e.useState(null),pe=e.useRef(null),[ve,xe]=e.useState(!1),fe=e.useCallback((e=>{const t=a();if(ae&&o(t)){e.preventDefault(),he.update((()=>{t.getNodes().forEach((e=>{l(e)&&e.remove()}))}))}return!1}),[he,ae]),we=e.useCallback((e=>{const t=a(),s=ie.current;if(ae&&o(t)&&1===t.getNodes().length){if(te)return c(null),e.preventDefault(),se.focus(),!0;if(null!==s&&s!==document.activeElement)return e.preventDefault(),s.focus(),!0}return!1}),[se,ae,te]),ye=e.useCallback((e=>(pe.current===se||ie.current===e.target)&&(c(null),he.update((()=>{oe(!0);const e=he.getRootElement();null!==e&&e.focus()})),!0)),[se,he,oe]),be=e.useCallback((e=>{const t=e;return!!ce||t.target===ne.current&&(t.shiftKey?oe(!ae):(le(),oe(!0)),!0)}),[ce,ae,oe,le]),ze=e.useCallback((e=>{he.getEditorState().read((()=>{const t=a();"IMG"===e.target.tagName&&d(t)&&1===t.getNodes().length&&he.dispatchCommand(J,e)}))}),[he]);e.useEffect((()=>{let e=!0;const t=he.getRootElement(),s=u(he.registerUpdateListener((({editorState:t})=>{e&&ge(t.read((()=>a())))})),he.registerCommand(w,((e,t)=>(pe.current=t,!1)),m),he.registerCommand(f,be,m),he.registerCommand(J,be,m),he.registerCommand(x,(e=>e.target===ne.current&&(e.preventDefault(),!0)),m),he.registerCommand(v,fe,m),he.registerCommand(p,fe,m),he.registerCommand(g,we,m),he.registerCommand(h,ye,m));return null==t||t.addEventListener("contextmenu",ze),()=>{e=!1,s(),null==t||t.removeEventListener("contextmenu",ze)}}),[le,he,ce,ae,K,fe,we,ye,be,ze,oe]);const{historyState:je}=y(),{settings:{showNestedEditorTreeView:Ce}}=b(),Re=ae&&o(me)&&!ce,Ee=ae||ce;return t.jsx(e.Suspense,{fallback:null,children:t.jsxs(t.Fragment,{children:[t.jsx("div",{draggable:Re,children:ve?t.jsx(Z,{}):t.jsx(Q,{className:Ee?"focused "+(o(me)?"draggable":""):null,src:s,altText:_,imageRef:ne,width:F,height:U,maxWidth:q,onError:()=>xe(!0)})}),te&&t.jsx("div",{className:"image-caption-container",children:t.jsxs(Y,{initialEditor:se,initialNodes:[z,j,C,R,E,N,H,P],children:[t.jsx(W,{}),t.jsx(S,{}),t.jsx(D,{}),t.jsx(L,{}),t.jsx(M,{}),t.jsx(k,{}),ue?t.jsx(V,{id:se.getKey(),providerFactory:$,shouldBootstrap:!0}):t.jsx(I,{externalHistoryState:je}),t.jsx(T,{contentEditable:t.jsx(X,{placeholder:"Enter a caption...",placeholderClassName:"ImageNode__placeholder",className:"ImageNode__contentEditable"}),ErrorBoundary:B}),!0===Ce?t.jsx(G,{}):null]})}),ee&&o(me)&&Ee&&t.jsx(O,{showCaption:te,setShowCaption:()=>{he.update((()=>{const e=A(K);l(e)&&e.setShowCaption(!0)}))},editor:he,buttonRef:ie,imageRef:ne,maxWidth:q,onResizeStart:()=>{de(!0)},onResizeEnd:(e,t)=>{setTimeout((()=>{de(!1)}),200),he.update((()=>{const s=A(K);l(s)&&s.setWidthAndHeight(e,t)}))},captionsEnabled:!ve&&re})]})})}export{J as RIGHT_CLICK_IMAGE_COMMAND,ee as default};
