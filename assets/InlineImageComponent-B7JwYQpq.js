import{W as e,r as t,f as a,u as s,b as n,c as i,X as l,i as o,m as r,K as c,l as d,n as u,o as m,p as h,D as g,q as p,S as f,j as x,A as j,y as C,M as v,O as b,Q as w,$ as E,Y as N,Z as y,_ as S,a0 as k}from"./index-BAeg54_S.js";import{L as I}from"./LexicalNestedComposer-ay-OKJoQ.js";const R=new Set;function _({altText:e,className:t,imageRef:a,src:s,width:n,height:i,position:l}){return function(e){if(!R.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{R.add(e),t(null)}}))}(s),x.jsx("img",{className:t||void 0,src:s,alt:e,ref:a,"data-position":l,style:{display:"block",height:i,width:n},draggable:"false"})}function D({activeEditor:e,nodeKey:a,onClose:s}){const n=e.getEditorState().read((()=>E(a))),[i,l]=t.useState(n.getAltText()),[o,r]=t.useState(n.getShowCaption()),[c,d]=t.useState(n.getPosition());return x.jsxs(x.Fragment,{children:[x.jsx("div",{style:{marginBottom:"1em"},children:x.jsx(N,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:l,value:i,"data-test-id":"image-modal-alt-text-input"})}),x.jsxs(y,{style:{marginBottom:"1em",width:"208px"},value:c,label:"Position",name:"position",id:"position-select",onChange:e=>{d(e.target.value)},children:[x.jsx("option",{value:"left",children:"Left"}),x.jsx("option",{value:"right",children:"Right"}),x.jsx("option",{value:"full",children:"Full Width"})]}),x.jsxs("div",{className:"Input__wrapper",children:[x.jsx("input",{id:"caption",type:"checkbox",checked:o,onChange:e=>{r(e.target.checked)}}),x.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),x.jsx(S,{children:x.jsx(k,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const t={altText:i,position:c,showCaption:o};n&&e.update((()=>{n.update(t)})),s()})(),children:"Confirm"})})]})}function T({src:E,altText:N,nodeKey:y,width:S,height:k,showCaption:R,caption:T,position:K}){const[F,L]=e(),A=t.useRef(null),B=t.useRef(null),[P,U,W]=a(y),[q]=s(),[M,O]=t.useState(null),Q=t.useRef(null),X=t.useCallback((e=>{const t=n();if(P&&i(t)){e.preventDefault(),P&&i(t)&&q.update((()=>{t.getNodes().forEach((e=>{l(e)&&e.remove()}))}))}return!1}),[q,P]),Y=t.useCallback((e=>{const t=n(),a=B.current;if(P&&i(t)&&1===t.getNodes().length){if(R)return o(null),e.preventDefault(),T.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[T,P,R]),Z=t.useCallback((e=>(Q.current===T||B.current===e.target)&&(o(null),q.update((()=>{U(!0);const e=q.getRootElement();null!==e&&e.focus()})),!0)),[T,q,U]);t.useEffect((()=>{let e=!0;const t=r(q.registerUpdateListener((({editorState:t})=>{e&&O(t.read((()=>n())))})),q.registerCommand(f,((e,t)=>(Q.current=t,!1)),d),q.registerCommand(p,(e=>{const t=e;return t.target===A.current&&(t.shiftKey?U(!P):(W(),U(!0)),!0)}),d),q.registerCommand(g,(e=>e.target===A.current&&(e.preventDefault(),!0)),d),q.registerCommand(h,X,d),q.registerCommand(m,X,d),q.registerCommand(u,Y,d),q.registerCommand(c,Z,d));return()=>{e=!1,t()}}),[W,q,P,y,X,Y,Z,U]);const $=P&&i(M),z=P;return x.jsxs(t.Suspense,{fallback:null,children:[x.jsxs(x.Fragment,{children:[x.jsxs("span",{draggable:$,children:[x.jsx("button",{className:"image-edit-button",ref:B,onClick:()=>{L("Update Inline Image",(e=>x.jsx(D,{activeEditor:q,nodeKey:y,onClose:e})))},children:"Edit"}),x.jsx(_,{className:z?"focused "+(i(M)?"draggable":""):null,src:E,altText:N,imageRef:A,width:S,height:k,position:K})]}),R&&x.jsx("span",{className:"image-caption-container",children:x.jsxs(I,{initialEditor:T,children:[x.jsx(j,{}),x.jsx(C,{}),x.jsx(v,{contentEditable:x.jsx(b,{placeholder:"Enter a caption...",placeholderClassName:"InlineImageNode__placeholder",className:"InlineImageNode__contentEditable"}),ErrorBoundary:w})]})})]}),F]})}export{D as UpdateInlineImageDialog,T as default};
